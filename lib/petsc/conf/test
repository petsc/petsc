# -*- mode: makefile -*-
#


TESTMODE = testexamples

ALLTESTS_PRINT_PROGRESS = no
# To print the sources use this
#ALLTESTS_PRINT_PROGRESS = debugtest
ALLTESTS_CHECK_FAILURES = no

alltests:
	-@${RM} -rf ${PETSC_ARCH}/lib/petsc/conf/alltests.log alltests.log
	+@if [ x${PETSC_ARCH} != x -a -d "${PETSC_ARCH}" ]; then \
            ln -s ${PETSC_ARCH}/lib/petsc/conf/alltests.log alltests.log ;\
            ALLTESTSLOG=${PETSC_ARCH}/lib/petsc/conf/alltests.log ;\
          else \
            ALLTESTSLOG=alltests.log ;\
          fi; \
          ${OMAKE} allgtest PETSC_ARCH=${PETSC_ARCH} PETSC_DIR=${PETSC_DIR} MPIEXEC="${MPIEXEC}" DATAFILESPATH=${DATAFILESPATH} 2>&1 | tee $${ALLTESTSLOG};\
          if [ x${ALLTESTS_CHECK_FAILURES} = xyes -a ${PETSC_PRECISION} != single ]; then \
            cat $${ALLTESTSLOG} | sed -e '1d' -e '$$d' | \
            grep -v '^[\*]\{7,7\} Testing: ${TESTMODE}_[a-zA-Z0-9_]* [\*]\{7,7\}$$' | \
            grep -v '^[\.]*$$' | wc -l | grep '^[ ]*0$$' > /dev/null; \
          fi;

allgtest-tap:
	+@MAKEFLAGS="-j$(MAKE_TEST_NP) $(MAKEFLAGS)" ${OMAKE} -f gmakefile.test test V=0

allgtest:
	+@MAKEFLAGS="-j$(MAKE_TEST_NP) $(MAKEFLAGS)" ${OMAKE} -k -f gmakefile.test test V=0 2>&1 | egrep -v '^(ok [^#]*(# SKIP|# TODO|$$)|[A-Za-z][A-Za-z0-9_]*\.(c|F|cxx|F90).$$)|warning: linker scope was specified more than once'




